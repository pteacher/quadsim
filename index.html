<html>
	<head>
		<meta charset="utf-8">
		<title>Quadsim - Симулятор управления квадрокоптером</title>
		<style>
			.line-error {
	            background: #CC2222 !important;
	            color: #8a1f11 !important;
	        }
		</style>
		
		<link rel="stylesheet prefetch prerender" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" data-noprefix>
		<link rel="stylesheet" href="./css/fa.css" data-noprefix>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.5.1/pixi.min.js"></script>

		<!--jquery ui styles-->
		<link rel="stylesheet" href="./css/jquery-ui.min.css">
		<link rel="stylesheet" href="./css/jquery-ui.structure.min.css">
		<link rel="stylesheet" href="./css/styles.css">

		<script src="./js/jquery.min.js"></script>
		<script src="./js/jquery-ui.min.js"></script>

		<script src="./codemirror/lib/codemirror.js"></script>
		<link rel="stylesheet" href="./codemirror/lib/codemirror.css">
		<script src="./codemirror/mode/javascript/javascript.js"></script>
		<link rel="stylesheet" href="./codemirror/theme/dracula.css">
		<script src="./codemirror/addon/scroll/simplescrollbars.js"></script>


		<!--codemirror modes-->
		<script src="./codemirror/mode/python/python.js"></script>
		<script src="./codemirror/mode/javascript/javascript.js"></script>

		<!--codemirror addons-->
		<script src="./codemirror/addon/fold/foldcode.js"></script>
		<script src="./codemirror/addon/fold/foldgutter.js"></script>
		<script src="./codemirror/addon/fold/brace-fold.js"></script>
		<script src="./codemirror/addon/edit/matchbrackets.js"></script>
		<script src="./codemirror/addon/edit/closetag.js"></script>
		<script src="./codemirror/addon/edit/closebrackets.js"></script>
		<script src="./codemirror/addon/scroll/simplescrollbars.js"></script>
		<script src="./codemirror/addon/selection/active-line.js"></script>

		<script src="./codemirror/keymap/sublime.js"></script>
	</head>
	<body>
	<div id="wrapper">
		<section id="utils">
			<div class="logo">
				<a href="#"></a>
			</div>
			<div class="code-swap">
				<span class="toggle-view">view <i class="fa fa-chevron-down"></i></span>
				<span class="run-script">Запуск <i class="fa fa-bolt"></i></span>
			</div>
			<div class="code-tools">
			</div>
		</section>
		<section id="editor">
			<div class="code-pane">
				<div class="code-pane-html">
					<textarea id="alimcode" name="alimcode"></textarea>
				</div>
			</div>
			<div class="preview-pane" id="game-canvas">
				<script src="./js/pixi.min.js"></script>
				<span class="preview-width" ></span>
			</div>
		</section>
	</div>
	<script type="text/javascript" src="./js/main.js"></script>
		<script src="js/three.js"></script>
		<script src="js/GLTFLoader.js"></script>
		<script>
			var xSpeed = 0.0;
			var ySpeed = 0.0;

			var clock = new THREE.Clock();
			var scene = new THREE.Scene();
			var model;
			scene.background = new THREE.Color( 0xbfe3dd );
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.position.y = 10;
			scene.add( new THREE.AmbientLight( 0x404040 ) );
			pointLight = new THREE.PointLight( 0xffffff, 1 );
			pointLight.position.copy( camera.position );
			scene.add( pointLight );
			var renderer = new THREE.WebGLRenderer();
			renderer.gammaOutput = true;
			renderer.gammaFactor = 2.2;
			renderer.setSize( window.innerWidth / 2, window.innerHeight / 2 );
			document.getElementById("game-canvas").appendChild( renderer.domElement );

			var floorTexture = new THREE.TextureLoader().load( 'images/checkerboard.jpg' );
			floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
			floorTexture.repeat.set( 10, 10 );
			var floorMaterial = new THREE.MeshBasicMaterial({ map: floorTexture, side: THREE.DoubleSide });
			var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 10, 10);
			var floor = new THREE.Mesh(floorGeometry, floorMaterial);
			floor.position.y = -0.5;
			floor.rotation.x = Math.PI / 2;
			scene.add(floor);

			var loader = new THREE.GLTFLoader();
				loader.load( 'models/scene.gltf', function ( gltf ) {
					model = gltf.scene;
					model.position.y = 6;
					scene.add( model );
					console.log(gltf.animations);
					

				}, undefined, function ( e ) {
					console.error( e );
				} ); 	

			camera.position.z = 13;
			y_sp = 0.01;

			var animate = function () {
				requestAnimationFrame( animate );
				var delta = clock.getDelta();
				model.children[0].children[0].children[0].children[6].rotation.z += 0.4;
				model.children[0].children[0].children[0].children[7].rotation.z -= 0.4;
				model.children[0].children[0].children[0].children[8].rotation.z += 0.4;
				model.children[0].children[0].children[0].children[9].rotation.z -= 0.4;
				model.position.z += ySpeed;
				model.position.x += xSpeed;
				model.rotation.x = ySpeed;
				model.rotation.z = -xSpeed;
				
				renderer.render( scene, camera );
			};

			document.addEventListener("keydown", onDocumentKeyDown, false);
			function onDocumentKeyDown(event) {

			    var keyCode = event.which;
			    console.log(keyCode);
			    if (keyCode == 40) {
			        ySpeed += 0.01;
			    } else if (keyCode == 38) {
			        ySpeed -= 0.01;
			    } else if (keyCode == 37) {
			        xSpeed -= 0.01;
			    } else if (keyCode == 39) {
			        xSpeed += 0.01;
			    } else if (keyCode == 32) {
			        model.position.set(0, 0, 0);
			    }
			};

			animate();
		</script>
	</body>
</html>